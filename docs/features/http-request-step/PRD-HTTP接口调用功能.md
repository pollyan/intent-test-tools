# HTTP接口调用功能产品需求文档 (PRD)

## 文档信息
- **功能名称**: HTTP接口调用步骤
- **版本**: v1.0
- **创建日期**: 2025-08-16
- **文档类型**: 产品需求文档 (PRD)
- **状态**: 需求分析完成

## 📋 目录
1. [功能概述](#功能概述)
2. [业务价值](#业务价值)  
3. [用户群体分析](#用户群体分析)
4. [功能需求](#功能需求)
5. [技术约束](#技术约束)
6. [验收标准](#验收标准)
7. [实现路线图](#实现路线图)

---

## 🎯 功能概述

### 功能定义
为Intent Test Framework添加HTTP接口调用步骤，支持在测试用例中执行RESTful API请求，实现UI测试与API测试的无缝集成。

### 核心价值主张
- **测试完整性**: 支持端到端测试流程，覆盖前后端交互
- **数据驱动**: 通过API动态获取和准备测试数据  
- **验证增强**: 在UI操作后验证后端数据状态
- **流程自动化**: 减少手动数据准备和环境配置工作

### 使用场景示例
```yaml
典型测试流程:
1. HTTP请求 - 创建测试用户账号
2. AI步骤 - 使用账号信息登录页面  
3. AI步骤 - 执行业务操作
4. HTTP请求 - 验证数据库中的状态变化
```

---

## 💼 业务价值

### 对用户的价值
1. **提高测试覆盖率**: 可以验证UI操作对后端的影响
2. **减少环境依赖**: 动态创建测试数据，不依赖固定环境
3. **提升测试效率**: 自动化数据准备，减少手工操作
4. **增强可靠性**: 通过API验证确保测试结果的准确性

### 对产品的价值
1. **功能完整性**: 成为真正的全栈测试解决方案
2. **竞争优势**: 区别于纯UI测试工具的差异化特性
3. **使用场景扩展**: 支持更复杂的业务测试流程
4. **用户粘性**: 提供更完整的测试工具链

---

## 👥 用户群体分析

### 主要用户
- **QA工程师**: 执行端到端测试，验证系统完整性
- **开发工程师**: 集成测试和回归测试
- **产品测试人员**: 业务流程验证

### 使用频率
- **高频场景**: 电商下单、用户注册、支付流程等
- **中频场景**: 数据同步验证、状态检查等
- **低频场景**: 环境准备、清理操作等

### 技术水平
- **初级用户**: 需要简单易用的配置界面
- **中级用户**: 需要支持常见的API操作模式  
- **高级用户**: 需要灵活的变量和断言功能

---

## 🔧 功能需求

### 核心功能需求

#### F1. HTTP请求执行
**优先级**: P0 (必须有)
- 支持HTTP方法: GET, POST, PUT, DELETE, PATCH
- URL配置支持变量替换: `${baseUrl}/api/users/${userId}`
- 请求头配置: 键值对形式，支持动态值
- 请求体配置: JSON格式支持
- 超时配置: 可配置请求超时时间

#### F2. 认证支持
**优先级**: P0 (必须有)
- Bearer Token认证: `Authorization: Bearer ${token}`
- API Key认证: Header或Query参数形式
- 基础认证: 用户名密码方式

#### F3. 响应处理
**优先级**: P0 (必须有)
- 状态码验证: 支持期望状态码断言
- 响应时间检查: 可配置最大响应时间
- JSON内容验证: 支持JSONPath表达式验证
- 变量提取: 从响应中提取数据存储为变量

#### F4. 变量集成
**优先级**: P0 (必须有)
- 请求中使用变量: 支持URL、Header、Body中的变量替换
- 响应数据存储: 提取的数据作为变量供后续步骤使用
- 变量作用域: 在整个测试用例执行过程中生效
- 数据类型识别: 自动识别字符串、数字、布尔值类型

#### F5. 错误处理
**优先级**: P1 (应该有)
- 网络错误重试: 可配置重试次数和间隔
- 错误信息记录: 详细的错误日志和堆栈信息
- 失败处理策略: 继续执行或终止测试的选择
- 断言失败提示: 清晰的断言失败原因说明

#### F6. 调试支持  
**优先级**: P1 (应该有)
- 请求响应日志: 完整的HTTP交互记录
- 执行时间统计: 各阶段耗时分析
- 变量值查看: 实时查看变量替换结果
- 错误诊断: 详细的错误定位信息

### 非功能需求

#### N1. 性能要求
- HTTP请求响应时间: < 30秒 (可配置)
- 变量提取处理: < 1秒 (对于常规JSON响应)
- UI操作响应: < 500ms (配置界面操作)

#### N2. 可用性要求
- 配置界面简洁直观，5分钟内可完成基础配置
- 错误信息清晰明确，非技术用户也能理解
- 支持配置模板和快速复制功能

#### N3. 兼容性要求
- 支持所有现有浏览器类型 (Chrome, Firefox, Safari, Edge)
- 与现有变量系统100%兼容
- 与现有步骤编辑器无缝集成

---

## ⚙️ 技术约束

### 架构约束
- **执行环境**: 必须在Playwright浏览器上下文中执行
- **变量系统**: 复用现有的变量管理机制
- **日志记录**: 统一使用现有的日志记录系统
- **错误处理**: 遵循现有的错误处理模式

### 技术选型约束
- **HTTP客户端**: 使用Playwright的fetch API
- **JSON处理**: 使用jsonpath-ng库进行变量提取
- **UI集成**: 扩展现有步骤编辑器，不创建独立组件
- **数据存储**: 使用现有的变量存储机制

### 兼容性约束
- 不能影响现有AI步骤的执行
- 必须支持现有的变量引用语法 `${variable}`
- 与现有的执行报告系统集成
- 支持现有的步骤排序和编辑功能

---

## ✅ 验收标准

### 基础功能验收
1. **HTTP请求执行**
   - [ ] 成功发送GET请求并接收响应
   - [ ] 成功发送POST请求与JSON数据
   - [ ] 成功发送PUT/DELETE/PATCH请求
   - [ ] 正确处理HTTP错误状态码
   - [ ] 支持请求超时配置和处理

2. **变量集成**
   - [ ] 在URL中正确替换变量值
   - [ ] 在请求头中正确使用变量
   - [ ] 在请求体中正确注入变量
   - [ ] 从响应中提取数据存储为变量
   - [ ] 变量在后续步骤中可正常使用

3. **认证功能**
   - [ ] Bearer Token认证正确添加到请求头
   - [ ] API Key认证正确添加到请求
   - [ ] 认证失败时给出清晰错误提示

4. **响应验证**
   - [ ] 状态码断言功能正常
   - [ ] JSON路径验证功能正常
   - [ ] 响应时间检查功能正常
   - [ ] 断言失败时给出明确错误信息

### 集成功能验收
1. **步骤编辑器集成**
   - [ ] HTTP步骤在编辑器中正确显示
   - [ ] 配置表单功能完整易用
   - [ ] 支持步骤拖拽排序
   - [ ] 支持步骤复制和删除

2. **执行流程集成**
   - [ ] HTTP步骤与AI步骤可正确协作
   - [ ] 变量在不同步骤间正确传递
   - [ ] 执行日志正确记录HTTP请求信息
   - [ ] 执行报告中正确显示HTTP步骤结果

3. **错误处理集成**
   - [ ] HTTP错误不影响后续步骤执行 (可配置)
   - [ ] 错误信息在执行报告中正确显示
   - [ ] 支持错误时的重试机制
   - [ ] 网络异常时的友好提示

### 用户体验验收
1. **配置便捷性**
   - [ ] 新用户5分钟内可完成基础配置
   - [ ] 常用配置可通过模板快速设置
   - [ ] 配置界面支持实时预览功能
   - [ ] 支持配置验证和错误提示

2. **调试友好性**
   - [ ] 提供完整的请求响应日志
   - [ ] 支持单步调试HTTP请求
   - [ ] 变量值可实时查看
   - [ ] 错误定位信息清晰准确

---

## 🗺️ 实现路线图

### 阶段1: 核心功能实现 (2-3周)
**目标**: 实现基础HTTP请求和变量集成功能

**里程碑**:
- HTTP请求执行器开发完成
- 基础变量替换和提取功能实现
- 简单的步骤配置界面完成
- 基础错误处理机制实现

**可交付成果**:
- 支持GET/POST请求的HTTP步骤
- 基础的变量使用和提取功能
- 简单的配置和调试界面
- 单元测试覆盖核心功能

### 阶段2: 增强功能实现 (1-2周)  
**目标**: 完善认证、验证和错误处理功能

**里程碑**:
- 认证机制完整实现
- 响应验证和断言功能完成
- 错误处理和重试机制完善
- 更多HTTP方法支持

**可交付成果**:
- 完整的认证支持 (Bearer Token, API Key)
- 状态码和内容验证功能
- 网络错误重试机制
- 更丰富的错误提示信息

### 阶段3: 用户体验优化 (1周)
**目标**: 优化用户界面和调试体验

**里程碑**:
- 配置界面优化完成
- 调试工具功能完善  
- 文档和帮助信息完整
- 完整的集成测试完成

**可交付成果**:
- JSON编辑器和语法高亮
- 完整的请求响应查看器
- 用户帮助文档和示例
- 端到端集成测试用例

### 发布计划
- **Alpha版本**: 阶段1完成后，内部测试版本
- **Beta版本**: 阶段2完成后，用户试用版本  
- **正式版本**: 阶段3完成后，生产环境发布

---

## 📊 成功指标

### 功能指标
- HTTP步骤执行成功率: > 95%
- 变量提取准确率: > 99%
- 认证成功率: > 98%
- 响应验证准确率: > 99%

### 性能指标
- HTTP请求平均响应时间: < 5秒
- 配置界面加载时间: < 2秒
- 变量提取处理时间: < 500ms
- 步骤编辑操作响应时间: < 300ms

### 用户体验指标
- 新用户完成首次配置时间: < 5分钟
- 用户配置错误率: < 10%
- 用户满意度评分: > 4.0/5.0
- 功能使用率: > 60%的用户在1个月内使用

---

## 📝 附录

### 相关文档
- [技术设计文档](./技术设计文档-HTTP接口调用.md)
- [用户故事文档](./用户故事-HTTP接口调用.md)  
- [API规格文档](./API规格-HTTP步骤配置.md)

### 参考资料
- [Intent Test Framework架构文档](../../architecture/)
- [现有变量系统文档](../../tools/数据流功能/)
- [MidSceneJS集成指南](../../../midscene_framework/)

---

*本文档将根据开发进展和用户反馈持续更新*