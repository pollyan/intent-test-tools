# Intent Test Framework 数据流功能使用指南

## 🚀 服务器已启动

服务器正在运行：**http://localhost:5001**

## 📋 如何使用数据流功能

### 1. 创建aiQuery步骤获取数据

在测试用例编辑器中，添加一个aiQuery步骤：

**动作类型**: `aiQuery - 提取结构化数据`

**动作参数**:
```json
{
  "schema": {
    "商品名称": "商品的名称, string",
    "价格": "商品价格, number",
    "库存": "库存数量, number",
    "是否促销": "是否在促销, boolean",
    "标签": "商品标签列表, array"
  }
}
```

**重要**: 在步骤编辑器的**高级选项**中设置 `output_variable` 为变量名，例如：`product_info`

### 2. 在后续步骤中使用变量

创建第二个步骤使用变量数据：

**动作类型**: `ai_tap - AI智能点击`

**动作参数**:
```json
{
  "locate": "购买${product_info.商品名称}按钮"
}
```

### 3. 支持的变量引用语法

| 语法 | 说明 | 示例 |
|------|------|------|
| `${变量名}` | 直接引用变量 | `${product_info}` |
| `${变量名.属性}` | 访问对象属性 | `${product_info.商品名称}` |
| `${变量名[索引]}` | 访问数组元素 | `${product_info.标签[0]}` |

### 4. 支持的AI方法

#### aiQuery - 结构化数据提取
```json
{
  "schema": {
    "字段名": "字段描述, 数据类型"
  }
}
```
支持的数据类型：`string`, `number`, `boolean`, `array`, `object`

#### aiString - 文本提取
```json
{
  "query": "获取页面标题"
}
```

#### aiAsk - AI智能分析
```json
{
  "query": "这个商品适合什么用户群体？"
}
```

#### evaluateJavaScript - JavaScript执行
```json
{
  "script": "return {url: window.location.href, title: document.title}"
}
```

### 5. 完整示例：电商测试流程

#### 步骤1: 导航到商品页面
- **动作**: `navigate`
- **参数**: `{"url": "https://demo-shop.com"}`

#### 步骤2: 提取商品信息
- **动作**: `aiQuery`
- **参数**: 
```json
{
  "schema": {
    "商品名称": "商品的名称, string",
    "价格": "商品价格, number",
    "商品ID": "商品唯一标识, string"
  }
}
```
- **输出变量**: `product_data`

#### 步骤3: 点击商品链接
- **动作**: `ai_tap`
- **参数**: `{"locate": "${product_data.商品名称}详情链接"}`

#### 步骤4: 验证页面信息
- **动作**: `ai_assert`
- **参数**: `{"condition": "页面显示商品${product_data.商品名称}的详细信息"}`

## 🎯 测试数据示例

系统会根据schema自动生成模拟数据：

```json
{
  "商品名称": "模拟名称_18",
  "价格": 549.99,
  "库存": 410,
  "是否促销": true,
  "标签": ["项目0_27", "项目1_27", "项目2_27"]
}
```

## ⚠️ 重要提示

1. **必须设置output_variable**: 在aiQuery等数据提取步骤中，务必在高级选项中设置输出变量名
2. **变量作用域**: 变量在同一次测试执行中全局可用
3. **中文支持**: 完全支持中文字段名和变量名
4. **数据类型**: 系统会自动识别并转换数据类型

## 🔧 调试技巧

1. **查看执行日志**: 执行测试时会显示变量解析和存储的详细信息
2. **变量验证**: 系统会自动验证变量引用的有效性
3. **错误提示**: 无效的变量引用会显示具体的错误信息

---

**开始测试**: 访问 http://localhost:5001/testcases/create 创建你的第一个数据流测试用例！