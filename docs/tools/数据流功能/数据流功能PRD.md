# Intent Test Framework 数据流功能 PRD

**文档版本**: 1.0  
**创建日期**: 2025-01-30  
**产品经理**: John  
**项目**: Intent Test Framework - 数据流功能增强  

---

## 📋 执行摘要

### 产品愿景
将Intent Test Framework从静态步骤执行工具升级为智能数据驱动测试平台，通过引入步骤间数据流传递、智能变量引用和用户友好的参数配置，显著提升测试用例创建效率和功能覆盖范围。

### 核心价值主张
- **效率提升30%**: 通过智能提示减少配置错误和重复工作
- **功能增强**: 支持复杂的数据驱动测试场景，覆盖更多业务用例
- **体验优化**: IDE级智能提示和表单化配置降低学习门槛
- **规模扩展**: 为企业级测试需求奠定技术基础

---

## 🎯 产品目标与成功指标

### 业务目标
| 目标 | 成功指标 | 目标值 | 测量方式 |
|------|----------|--------|----------|
| 提升用户效率 | 测试用例创建时间 | 减少30% | 用户行为分析 |
| 减少配置错误 | 参数配置错误率 | 降低50% | 错误日志统计 |
| 扩大使用场景 | 数据流功能采用率 | >70% | 功能使用统计 |
| 提升用户满意度 | NPS评分 | >8.0 | 用户调研 |

### 技术目标
| 指标 | 目标值 | 测量方式 |
|------|--------|----------|
| 智能提示响应时间 | <200ms | APM监控 |
| 变量解析处理时间 | <500ms | 性能测试 |
| 系统可用性 | 99.9% | 监控告警 |
| 向后兼容性 | 100% | 回归测试 |

---

## 👥 目标用户与用例

### 主要用户群体

#### 1. 测试工程师 (Primary User)
**用户画像**: 有一定技术背景，熟悉测试工具，追求效率
**核心需求**: 
- 快速创建复杂测试用例
- 减少重复配置和人工错误
- 支持数据驱动的测试场景

**使用场景**:
- 电商测试：提取商品价格，在后续步骤中验证计算结果
- 用户流程测试：提取用户信息，在多个页面中验证数据一致性
- API测试：提取响应数据，用于后续请求的参数

#### 2. QA负责人 (Secondary User)
**用户画像**: 管理测试团队，关注团队效率和测试覆盖率
**核心需求**:
- 提升团队整体测试效率
- 降低新人学习成本
- 扩大自动化测试覆盖范围

#### 3. 业务测试人员 (Tertiary User)
**用户画像**: 业务背景，技术能力有限，关注功能可用性
**核心需求**:
- 简单易用的界面
- 明确的操作指引
- 少量配置即可完成复杂测试

### 用户旅程地图

#### 当前状态 (Current State)
```
发现需求 → 手动配置JSON → 频繁出错 → 反复调试 → 完成测试
   ↓           ↓           ↓           ↓           ↓
 明确但繁琐  容易出错   挫败感强   时间消耗大  效率低下
```

#### 目标状态 (Future State)
```
发现需求 → 表单化配置 → 智能提示 → 一次成功 → 高效完成
   ↓           ↓           ↓           ↓           ↓
 需求明确   界面友好   错误预防   体验流畅   效率提升
```

---

## 💎 核心功能需求

### 功能优先级矩阵
| 功能 | 用户价值 | 技术复杂度 | 优先级 |
|------|----------|------------|---------|
| 数据提取与输出 | 高 | 中 | P0 |
| 变量引用系统 | 高 | 中 | P0 |
| 智能提示系统 | 高 | 高 | P0 |
| 参数表单优化 | 中 | 中 | P1 |
| 数据流可视化 | 低 | 高 | P2 |

### P0 功能详细规格

#### 1. 现有API返回值捕获功能

**功能描述**: 现有Midscene API方法的返回值能够被自动捕获并存储为变量

**用户故事**:
```
作为测试工程师
我希望现有的Midscene API方法（如aiQuery、aiString、aiNumber等）的返回值能够自动保存
以便在后续步骤中引用和使用这些数据
这样我就能创建更复杂的数据驱动测试用例，而无需学习新的操作类型
```

**功能细节**:
- **支持的现有Action类型**:
  - `aiQuery`: 返回结构化数据 (Promise<T>)
  - `aiString`: 返回字符串数据 (Promise<string>)
  - `aiNumber`: 返回数字数据 (Promise<number>)
  - `aiBoolean`: 返回布尔值数据 (Promise<boolean>)
  - `aiAsk`: 返回AI问答结果 (Promise<string>)
  - `aiLocate`: 返回元素位置信息 (Promise<{rect, center, scale}>)
  - `evaluateJavaScript`: 返回JS执行结果 (Promise<any>)

- **新增配置参数**:
  - `output_variable`: 输出变量名（可选，当需要保存返回值时提供）

- **使用示例**:
```json
{
  "action": "aiQuery",
  "params": {
    "query": "提取商品的价格和库存信息",
    "dataDemand": "{price: number, stock: number}"
  },
  "output_variable": "product_info",
  "description": "提取商品基本信息"
}
```

**验收标准**:
- ✅ 支持所有有返回值的Midscene API方法的输出捕获
- ✅ 返回值数据能够正确存储到执行上下文中
- ✅ 支持复杂对象、数组和基础数据类型
- ✅ API调用失败时有清晰的错误提示
- ✅ 执行历史中记录捕获的返回值数据

#### 2. 变量引用系统

**功能描述**: 后续步骤可以通过简单语法引用前面步骤提取的数据

**用户故事**:
```
作为测试工程师
我希望使用简单的语法（如${product_info.price}）
来引用之前步骤提取的数据
这样我就能在测试流程中传递和使用数据
```

**功能细节**:
- **语法支持**:
  - 简单变量引用: `${variable_name}`
  - 对象属性访问: `${variable_name.property}`
  - 嵌套属性访问: `${user.profile.name}`
  - 数组元素访问: `${products[0].name}`

- **变量作用域**:
  - 变量在整个测试用例执行期间有效
  - 变量按步骤顺序创建，只能引用之前步骤的输出
  - 执行结束后自动清理变量上下文

- **类型转换**:
  - 自动类型转换（数字、字符串、布尔值）
  - 对象和数组的JSON字符串化
  - 错误类型转换时的友好提示

**验收标准**:
- ✅ 支持`${variable}`和`${variable.property}`语法
- ✅ 支持最多5层的嵌套属性访问
- ✅ 运行时正确解析和替换变量引用
- ✅ 未定义变量时有清晰的错误提示
- ✅ 变量值在执行监控界面中可见

#### 3. 智能提示系统

**功能描述**: 参数输入时提供IDE级别的智能代码完成功能

**用户故事**:
```
作为测试工程师
我希望在输入变量引用时获得自动完成提示
包括变量名、类型、来源步骤等信息
这样我就能避免拼写错误，提高配置效率
```

**功能细节**:
- **触发机制**:
  - 输入`${`时自动弹出提示菜单
  - 输入变量名时实时过滤匹配项
  - 支持模糊搜索（如输入"prod"匹配"product_info"）

- **提示内容**:
  - 变量名和完整路径
  - 数据类型（string, number, object等）
  - 来源步骤信息
  - 实际数据预览（执行过程中）

- **交互方式**:
  - 鼠标点击选择
  - 键盘导航（上下箭头、Enter确认、ESC取消）
  - Tab键快速补全

**验收标准**:
- ✅ 输入`${`时触发提示菜单（响应时间<200ms）
- ✅ 显示可用变量列表，包含类型和来源信息
- ✅ 支持模糊搜索和实时过滤
- ✅ 键盘快捷键操作流畅
- ✅ 支持复杂嵌套对象的属性提示

### P1 功能规格

#### 4. 参数表单优化

**功能描述**: 将复杂的JSON参数配置转换为用户友好的表单界面

**用户故事**:
```
作为业务测试人员
我希望通过友好的表单界面配置步骤参数
而不是手动编写复杂的JSON格式
这样我就能更容易地创建和维护测试用例
```

**功能细节**:
- **动态表单生成**:
  - 根据Action类型自动生成对应表单
  - 区分必需参数和可选参数
  - 不同参数类型使用合适的输入组件

- **参数类型支持**:
  - 字符串输入框（支持变量引用）
  - 数字输入框（范围验证）
  - 下拉选择框
  - 多行文本框
  - 变量名输入（格式验证）

- **实时验证**:
  - 参数格式验证
  - 变量引用有效性检查
  - 必需参数完整性检查

**验收标准**:
- ✅ 每种Action类型有标准化的参数定义
- ✅ 自动生成对应的参数配置表单
- ✅ 实时参数验证和错误提示
- ✅ 支持必需参数和可选参数的区分显示
- ✅ 表单数据正确转换为JSON格式

---

## 🎨 用户体验设计

### 设计原则

#### 1. 渐进式披露 (Progressive Disclosure)
- 默认显示核心功能，高级选项可展开
- 新手引导逐步介绍功能
- 复杂配置通过向导模式简化

#### 2. 即时反馈 (Immediate Feedback)
- 输入验证实时显示结果
- 智能提示立即响应用户输入
- 错误信息清晰且可操作

#### 3. 一致性 (Consistency)
- 统一的变量引用语法
- 一致的表单组件和交互模式
- 统一的视觉设计语言

### 关键界面设计

#### 1. 步骤编辑器增强

**当前状态**:
```
┌─────────────────────────────────────┐
│ Action: ai_input                    │
│ ┌─────────────────────────────────┐ │
│ │ {                               │ │
│ │   "text": "搜索内容",           │ │
│ │   "locate": "搜索框"            │ │
│ │ }                               │ │
│ └─────────────────────────────────┘ │
└─────────────────────────────────────┘
```

**目标状态**:
```
┌─────────────────────────────────────┐
│ 智能输入 ⌨️                         │
├─────────────────────────────────────┤
│ 必需参数                            │
│ 输入文本: [搜索${prod■]             │
│           ┌─────────────────────┐   │
│           │ product_name        │   │
│           │ product_info.price  │   │
│           │ product_category    │   │
│           └─────────────────────┘   │
│ 目标元素: [搜索框            ]       │
│                                     │
│ 可选参数 ▼                          │
│ 超时时间: [5000] 毫秒               │
└─────────────────────────────────────┘
```

#### 2. 变量浏览器

```
┌─────────────────────────────────────┐
│ 📊 可用变量                         │
├─────────────────────────────────────┤
│ 🏷️ product_info          步骤 2    │
│   ├─ price: 99.99       (number)   │
│   ├─ stock: 10          (number)   │
│   └─ category: "电子"   (string)   │
│                                     │
│ 🏷️ user_data             步骤 1    │
│   ├─ name: "张三"       (string)   │
│   └─ email: "..."       (string)   │
└─────────────────────────────────────┘
```

#### 3. 执行监控增强

```
┌─────────────────────────────────────┐
│ 步骤 2: 提取商品信息               │
│ ├─ 状态: ✅ 成功                   │
│ ├─ 耗时: 2.3秒                     │
│ └─ 输出变量: product_info          │
│    └─ 值: {"price": 99.99, ...}    │
│                                     │
│ 步骤 3: 验证价格显示               │
│ ├─ 状态: 🔄 执行中                 │
│ ├─ 参数解析:                       │
│ │  "价格：${product_info.price}"   │
│ │      ↓                          │
│ │  "价格：99.99"                  │
└─────────────────────────────────────┘
```

---

## 🔧 技术需求

### 功能性需求

#### 1. 数据存储需求
- **变量存储**: 执行期间的变量数据需要持久化存储
- **类型支持**: 支持字符串、数字、布尔值、JSON对象、数组类型
- **生命周期**: 变量在测试执行期间有效，执行结束后清理
- **并发安全**: 多个测试并发执行时的数据隔离

#### 2. 性能需求
| 功能 | 性能指标 | 测量条件 |
|------|----------|----------|
| 智能提示响应 | <200ms | P95响应时间 |
| 变量解析处理 | <500ms | 包含10个变量的步骤 |
| 数据提取操作 | <10s | P90响应时间 |
| 表单验证反馈 | <100ms | 实时验证响应 |

#### 3. 可用性需求
- **系统可用性**: 99.9%月度可用性
- **错误恢复**: 单个步骤失败不影响整体执行
- **数据完整性**: 变量数据的一致性和完整性保证
- **向后兼容**: 100%兼容现有测试用例

### 非功能性需求

#### 1. 可扩展性
- **变量数量**: 单测试用例支持100+变量
- **并发执行**: 支持1000+并发测试执行
- **数据量**: 单个变量支持1MB数据存储
- **嵌套深度**: 支持5层嵌套对象访问

#### 2. 安全性
- **数据加密**: 敏感变量数据加密存储
- **访问控制**: 基于用户权限的变量访问控制
- **输入验证**: 防止代码注入和XSS攻击
- **审计日志**: 变量操作的完整审计记录

#### 3. 可维护性
- **代码覆盖率**: >80%测试覆盖率
- **文档完善**: API文档和用户文档齐全
- **监控告警**: 完整的性能和错误监控
- **升级策略**: 平滑的版本升级机制

---

## 📅 发布计划

### 里程碑规划

#### Phase 1: 核心数据流功能 (Week 1-3)
**目标**: 实现基础的数据提取和变量引用功能

**交付内容**:
- ✅ 数据提取Actions（ai_extract_string, ai_extract_number, ai_extract_object）
- ✅ 变量引用语法解析和替换
- ✅ 基础的执行上下文管理
- ✅ 数据库Schema扩展和迁移

**验收标准**:
- 能够提取页面数据并存储为变量
- 后续步骤能够引用变量数据
- 基本的错误处理和日志记录

#### Phase 2: 智能提示系统 (Week 4-6)
**目标**: 实现IDE级别的智能提示功能

**交付内容**:
- ✅ SmartVariableInput React组件
- ✅ 变量提示菜单和交互逻辑
- ✅ 模糊搜索和实时过滤
- ✅ 键盘快捷键支持

**验收标准**:
- 输入变量语法时自动触发提示
- 提示内容准确且响应迅速（<200ms）
- 键盘和鼠标交互流畅

#### Phase 3: 参数表单优化 (Week 7-9)
**目标**: 提供用户友好的参数配置体验

**交付内容**:
- ✅ Action定义标准化系统
- ✅ 动态表单生成器
- ✅ 实时参数验证
- ✅ 现有界面集成

**验收标准**:
- 所有Action类型支持表单化配置
- 参数验证准确且用户友好
- 向后兼容现有配置方式

#### Phase 4: 测试与发布 (Week 10)
**目标**: 质量保证和生产环境部署

**交付内容**:
- ✅ 完整的单元测试和集成测试
- ✅ 性能测试和优化
- ✅ 用户文档和培训材料
- ✅ 生产环境部署

**验收标准**:
- 所有功能测试通过
- 性能指标达到预期
- 用户接受度测试通过

### 发布策略

#### 1. 灰度发布 (Beta Release)
- **用户范围**: 10%内部用户
- **功能范围**: 核心数据流功能
- **发布时间**: Week 8
- **反馈收集**: 2周收集期

#### 2. 正式发布 (General Availability)
- **用户范围**: 所有用户
- **功能范围**: 完整功能集
- **发布时间**: Week 11
- **推广计划**: 功能演示和培训

---

## 📊 风险评估与缓解

### 高风险项

#### 1. 技术风险: MidSceneJS API集成复杂性
**风险级别**: 高  
**影响**: 可能导致数据提取功能不稳定  
**缓解措施**:
- 版本锁定和兼容性测试
- 建立适配层隔离变更
- 准备回退方案

#### 2. 用户风险: 学习成本增加
**风险级别**: 中  
**影响**: 用户采用率可能低于预期  
**缓解措施**:
- 渐进式功能介绍
- 详细的用户指南和视频教程
- 用户反馈快速迭代

#### 3. 性能风险: 大量变量处理影响系统性能
**风险级别**: 中  
**影响**: 系统响应速度下降  
**缓解措施**:
- 多层缓存策略
- 异步处理和优化算法
- 性能监控和告警

### 中等风险项

#### 1. 兼容性风险: 现有功能向后兼容
**风险级别**: 中  
**影响**: 现有用户工作流中断  
**缓解措施**:
- 完整的回归测试
- 分阶段迁移策略
- 用户通知和支持

#### 2. 数据风险: 变量数据安全和隐私
**风险级别**: 中  
**影响**: 用户数据泄露风险  
**缓解措施**:
- 数据加密存储
- 访问权限控制
- 定期安全审计

---

## 📈 成功度量

### 关键绩效指标 (KPIs)

#### 业务指标
| 指标 | 基线值 | 目标值 | 测量周期 |
|------|--------|--------|----------|
| 测试用例创建时间 | 15分钟 | <10分钟 | 月度 |
| 参数配置错误率 | 20% | <10% | 月度 |
| 功能使用率 | 0% | >70% | 季度 |
| 用户满意度 | 7.2 | >8.0 | 季度 |

#### 技术指标
| 指标 | 目标值 | 监控方式 |
|------|--------|----------|
| 智能提示响应时间 | <200ms | APM实时监控 |
| 变量解析成功率 | >99% | 错误日志统计 |
| 系统可用性 | 99.9% | 监控告警 |
| API错误率 | <0.1% | 日志分析 |

#### 用户行为指标
| 指标 | 目标值 | 测量方式 |
|------|--------|----------|
| 智能提示使用率 | >80% | 前端埋点 |
| 变量功能使用率 | >60% | 功能统计 |
| 表单配置使用率 | >70% | 行为分析 |
| 帮助文档访问率 | >50% | 访问统计 |

### 用户满意度测量

#### 1. 定量指标
- **NPS评分**: 净推荐值 > 8.0
- **任务完成率**: 核心任务完成率 > 90%
- **错误率**: 用户操作错误率 < 5%
- **学习时间**: 新功能掌握时间 < 30分钟

#### 2. 定性反馈
- **用户访谈**: 月度深度访谈5-10个核心用户
- **问卷调研**: 季度功能满意度调研
- **支持反馈**: 客服和技术支持反馈收集
- **社区反馈**: 用户社区讨论和建议收集

---

## 🔄 后续发展规划

### 短期优化 (3-6个月)

#### 1. 功能增强
- **条件执行**: 基于变量值的条件步骤执行
- **循环执行**: 支持基于数据集的循环测试
- **数据转换**: 变量数据的格式转换和计算
- **批量操作**: 多个变量的批量管理

#### 2. 用户体验优化
- **可视化工具**: 数据流关系的图形化展示
- **模板市场**: 常用测试模板的分享和复用
- **智能推荐**: 基于上下文的操作建议
- **快捷操作**: 键盘快捷键和批量操作

### 长期愿景 (6-12个月)

#### 1. AI增强功能
- **智能测试生成**: 基于页面内容自动生成测试步骤
- **异常检测**: AI识别测试执行中的异常模式
- **优化建议**: 基于执行数据的测试优化建议
- **自然语言**: 支持自然语言描述的测试用例

#### 2. 企业级功能
- **多租户支持**: 企业级的团队和权限管理
- **审计合规**: 完整的操作审计和合规报告
- **API集成**: 与企业CI/CD系统的深度集成
- **大规模部署**: 支持大规模并发和分布式执行

---

## 📞 项目干系人

### 核心团队
- **产品经理**: John - 整体产品规划和需求管理
- **业务分析师**: Mary - 需求分析和用户研究
- **架构师**: Winston - 技术架构设计和指导
- **前端负责人**: [待定] - React组件和用户界面开发
- **后端负责人**: [待定] - Flask API和数据处理逻辑
- **QA负责人**: [待定] - 测试策略和质量保证

### 利益相关者
- **用户代表**: 核心用户参与需求验证和反馈
- **技术负责人**: 技术决策和资源协调
- **运维团队**: 部署和监控支持
- **客户成功**: 用户培训和支持

---

## 📎 附录

### A. 用户故事完整列表

#### Epic 1: 数据提取功能
- **US-001**: 作为测试工程师，我希望提取页面中的字符串数据
- **US-002**: 作为测试工程师，我希望提取页面中的数字数据
- **US-003**: 作为测试工程师，我希望提取页面中的复杂对象数据
- **US-004**: 作为测试工程师，我希望定义数据提取的结构Schema
- **US-005**: 作为测试工程师，我希望查看数据提取的执行结果

#### Epic 2: 变量引用功能
- **US-006**: 作为测试工程师，我希望在步骤参数中引用变量
- **US-007**: 作为测试工程师，我希望访问对象变量的属性
- **US-008**: 作为测试工程师，我希望访问数组变量的元素
- **US-009**: 作为测试工程师，我希望获得变量引用错误的清晰提示
- **US-010**: 作为测试工程师，我希望在执行过程中查看变量值

#### Epic 3: 智能提示功能
- **US-011**: 作为测试工程师，我希望输入变量时获得自动补全
- **US-012**: 作为测试工程师，我希望看到变量的类型和来源信息
- **US-013**: 作为测试工程师，我希望通过模糊搜索快速找到变量
- **US-014**: 作为测试工程师，我希望使用键盘快捷键操作提示菜单
- **US-015**: 作为测试工程师，我希望看到变量的实际值预览

#### Epic 4: 参数表单优化
- **US-016**: 作为业务测试人员，我希望通过表单配置步骤参数
- **US-017**: 作为业务测试人员，我希望看到参数的实时验证结果
- **US-018**: 作为业务测试人员，我希望获得参数配置的帮助信息
- **US-019**: 作为业务测试人员，我希望区分必需和可选参数
- **US-020**: 作为测试工程师，我希望切换高级和简单配置模式

### B. 技术债务清单
1. **数据库性能优化**: 变量查询的索引优化
2. **缓存策略**: 智能提示数据的缓存机制
3. **错误处理**: 统一的错误处理和用户提示
4. **日志完善**: 详细的操作日志和调试信息
5. **安全加固**: 变量数据的加密和权限控制

### C. 参考资料
- MidSceneJS官方文档: https://midscenejs.com/
- React最佳实践指南
- Flask RESTful API设计规范
- PostgreSQL性能优化指南
- 用户体验设计原则

---

**文档审批状态**:
- [ ] 产品负责人审批
- [ ] 技术负责人审批
- [ ] 用户代表确认
- [ ] 项目经理审批

*本PRD文档将根据项目进展和用户反馈持续更新。如有任何疑问或建议，请及时沟通讨论。*